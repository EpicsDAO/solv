---
id: quickstart-no-downtime-update
title: ノーダウンタイムアップデート
description: オープンソースのSolana バリデーター向けツールsolvのクイックスタート - ノーダウンタイムアップデート
---

バリデーターノードのダウンタイム要件は、Solana ネットワークの安定性を維持するために非常に重要です。
solv v4 では、バリデーターノードのノーダウンタイム移行をサポートするための新しいコマンドを追加しました。

日々のアップデート作業においてもノーダウンタイム移行を行うことで、バリデータースコアを高く保ち信頼性を上げ、Solana ネットワークの安定性にも貢献できます。
また、バリデーターノードの引っ越しにも有効で、戦略的・もしくは緊急の場合のノード移行においてもダウンタイム無く移行が可能なため、バリデーターの運用をより安定させることができます。

## 事前準備

移行元のノードと移行先のノードが正常に稼働していることを確認してください。
移行元を Active、移行先を Inactive として説明します。

solv change コマンドを使って移行するためには、以下の条件を満たしている必要があります。

- solv v4 で起動したソラナバリデーターノードであること
  (solv v4 以前のバージョンからも移行可能ですが、詳しくは Discord でお問い合わせください。)

- solv catchup で最新のブロックに追いついていること
- SSH 接続が移行元から移行先へ可能であること

以下、１台のノードがすでに稼働中で、２台目のノードを新たに立ち上げる場合の手順を説明します。

## 新規ノードの立ち上げ (Inactive ノード)

新規ノードを立ち上げ、solv v4 で起動します。

```bash
$ solv setup
```

ダミーノードかどうかを対話式で確認されますので、y を選択してください。
起動開始直後、一度ノードを停止して、移行元の鍵に入れ替えます。

```bash
$ solv stop
```

## 新規ノードに移行元の鍵をアップロード (Inactive ノード)

移行元のノードから移行先のノードへ

- mainnet-validator-keypair.json
- mainnet-vote-account-keypair.json
- mainnet-authority-keypair.json

をアップロードします。

鍵のダウンロード/アップロードには、solv scp コマンドを使用します。

```bash
$ solv scp --help
```

鍵の交換後、新規ノードを再起動します。

```bash
$ solv start
```

そして、新規ノードが最新のブロックに追いつくまで待ちます。

```bash
$ solv catchup
```

この待ち時間はネットワーク状況によりますが、通常は数時間かかります。
コンピューターのスペックが低かったり、ネットワークが不安定な場合は、
追いつかない場合があります。その場合は、再度ネットワークやスペックを確認してください。

## SSH 接続の設定 (Active ノード)

移行元ノードから移行先ノードへの SSH 接続を設定します。

### Key Pair の生成

移行元ノードで SSH Key Pair を生成します。

```bash
$ solv scp init
```

`~/.ssh/id_rsa.pub` に公開鍵が生成されます。
この公開鍵をコピーしておきます。

### 移行先ノードへの SSH 接続設定 (Inactive ノード)

移行先ノードで、公開鍵を追加します。

```bash
$ solv scp create
```

`? Enter your SSH Public Key (xxxxxxxpubkeyxxxxxxxx)` と表示されるので、

先ほどコピーした公開鍵を貼り付けます。

### 移行元ノードから移行先ノードへの SSH 接続 (Active ノード)

移行元ノードから移行先ノードへ SSH 接続します。

```bash
$ ssh solv@<移行先ノードのIPアドレス>
```

接続が成功したら、移行元ノードから移行先ノードへの SSH 接続設定は完了です。

## ノードの移行

移行元ノードから移行先ノードへの移行を行います。
この時、両方のノードが正常に稼働していることを確認してください。

```bash
$ solv monitor
```

`solv change` コマンドは

移行元 -> 移行先

という順番で実行します。

### solv change の実行 (Active ノード)

```bash
$ solv change
```

移行先の IP アドレスを入力してください。
y を選択すると、移行が開始されます。

### solv change の実行 (Inactive ノード)

```bash
$ solv change
```

これで、ノードの移行が完了しました。
